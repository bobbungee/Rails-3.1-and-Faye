# init client
client = new Faye.Client('<%= FAYE_URI.to_s %>')

# Logging
Logger = {
  incoming: (message, callback) ->
    console.log('incoming', message);
    callback(message);
  ,
  outgoing: (message, callback) ->
    console.log('outgoing', message)
    callback(message)
  
}

client.addExtension(Logger);

room = 'general'

change_room = (new_room) ->
  client.unsubscribe("/#{room}")
  easy_subscribe("#{new_room}")
  room = new_room

easy_subscribe = (room) ->
  client.subscribe("/#{room}", (message) ->
    alert(message)
  )

sendmessage = (channel, message) ->
  $.ajax({
    url: "/home/message#{channel}?message=#{message}",
    type: "POST"
  })

addmessage = (message) ->
  sendmessage("/#{room}", message)

sendmessage('/general', 'Someone else is now viewing this page!')

easy_subscribe(room)
